STEP 1: DATABASE STRUCTURE

Open database.

Open users table migration.

If not created, run:

php artisan make:migration create_users_table

Now open:
database/migrations/xxxx_create_users_table.php

Replace with:

public function up()
{
    Schema::create('users', function (Blueprint $table) {
        $table->id();
        $table->string('name');
        $table->string('email')->unique();
        $table->string('mobile')->nullable();
        $table->string('password');
        $table->string('status')->default('unverified'); 
        $table->timestamps();
        $table->softDeletes();
    });
}

Now run:

php artisan migrate

STEP 2: UPDATE USER MODEL

Open:
app/Models/User.php

Add:

use Illuminate\Database\Eloquent\SoftDeletes;

class User extends Authenticatable
{
    use SoftDeletes;

    protected $fillable = [
        'name',
        'email',
        'mobile',
        'password',
        'status'
    ];
}
STEP 3: USER AUTH CONTROLLER

Create controller:

php artisan make:controller User/AuthController

Open:
app/Http/Controllers/User/AuthController.php

Full code:

namespace App\Http\Controllers\User;

use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use App\Models\User;
use Illuminate\Support\Facades\Hash;

class AuthController extends Controller
{
    public function showRegister()
    {
        return view('user.register');
    }

    public function register(Request $request)
    {
        User::create([
            'name' => $request->name,
            'email' => $request->email,
            'mobile' => $request->mobile,
            'password' => Hash::make($request->password),
            'status' => 'unverified'
        ]);

        return redirect('/login');
    }

    public function showLogin()
    {
        return view('user.login');
    }

    public function login(Request $request)
    {
        $user = User::where('email', $request->email)->first();

        if (!$user) {
            return back()->with('error', 'User not found');
        }

        if (!Hash::check($request->password, $user->password)) {
            return back()->with('error', 'Wrong password');
        }

        if ($user->status != 'verified') {
            return back()->with('error', 'Wait for admin verification');
        }

        session(['user_id' => $user->id]);

        return redirect('/dashboard');
    }

    public function logout()
    {
        session()->forget('user_id');
        return redirect('/login');
    }
}
STEP 4: USER PROFILE CONTROLLER

Create:

php artisan make:controller User/ProfileController

Open:
app/Http/Controllers/User/ProfileController.php

Full code:

namespace App\Http\Controllers\User;

use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use App\Models\User;
use Illuminate\Support\Facades\Hash;

class ProfileController extends Controller
{
    public function dashboard()
    {
        return view('user.dashboard');
    }

    public function edit()
    {
        $user = User::find(session('user_id'));
        return view('user.edit', compact('user'));
    }

    public function update(Request $request)
    {
        $user = User::find(session('user_id'));

        $user->name = $request->name;
        $user->mobile = $request->mobile;
        $user->save();

        return back();
    }

    public function changeForm()
    {
        return view('user.change');
    }

    public function changePassword(Request $request)
    {
        $user = User::find(session('user_id'));

        if (!Hash::check($request->current_password, $user->password)) {
            return back()->with('error', 'Current password wrong');
        }

        if ($request->new_password != $request->confirm_password) {
            return back()->with('error', 'Passwords not matching');
        }

        $user->password = Hash::make($request->new_password);
        $user->save();

        return back();
    }
}
STEP 5: USER MIDDLEWARE

Create:

php artisan make:middleware UserMiddleware

Open:
app/Http/Middleware/UserMiddleware.php

public function handle($request, Closure $next)
{
    if (!session()->has('user_id')) {
        return redirect('/login');
    }

    return $next($request);
}

Register in:
app/Http/Kernel.php

'user.auth' => \App\Http\Middleware\UserMiddleware::class,
STEP 6: ADMIN CONTROLLER

Create:

php artisan make:controller Admin/AdminController

Open:
app/Http/Controllers/Admin/AdminController.php

Full code:

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use App\Models\User;

class AdminController extends Controller
{
    public function showLogin()
    {
        return view('admin.login');
    }

    public function login(Request $request)
    {
        if ($request->email == 'admin@gmail.com' && $request->password == '1234') {
            session(['admin' => true]);
            return redirect('/admin/dashboard');
        }

        return back()->with('error', 'Invalid admin credentials');
    }

    public function dashboard()
    {
        return view('admin.dashboard');
    }

    public function unverified()
    {
        $users = User::where('status', 'unverified')->get();
        return view('admin.unverified', compact('users'));
    }

    public function verified()
    {
        $users = User::where('status', 'verified')->get();
        return view('admin.verified', compact('users'));
    }

    public function inactive()
    {
        $users = User::onlyTrashed()->get();
        return view('admin.inactive', compact('users'));
    }

    public function verifyUser($id)
    {
        $user = User::find($id);
        $user->status = 'verified';
        $user->save();

        return back();
    }

    public function inactiveUser($id)
    {
        $user = User::find($id);
        $user->delete();

        return back();
    }

    public function logout()
    {
        session()->forget('admin');
        return redirect('/admin/login');
    }
}
STEP 7: ADMIN MIDDLEWARE

Create:

php artisan make:middleware AdminMiddleware

Open:
app/Http/Middleware/AdminMiddleware.php

public function handle($request, Closure $next)
{
    if (!session()->has('admin')) {
        return redirect('/admin/login');
    }

    return $next($request);
}

Register in Kernel:

'admin.auth' => \App\Http\Middleware\AdminMiddleware::class,
STEP 8: ROUTES

Open routes/web.php

Full routes:

use App\Http\Controllers\User\AuthController;
use App\Http\Controllers\User\ProfileController;
use App\Http\Controllers\Admin\AdminController;

/* User */

Route::get('/register', [AuthController::class, 'showRegister']);
Route::post('/register', [AuthController::class, 'register']);

Route::get('/login', [AuthController::class, 'showLogin']);
Route::post('/login', [AuthController::class, 'login']);
Route::get('/logout', [AuthController::class, 'logout']);

Route::middleware(['user.auth'])->group(function () {
    Route::get('/dashboard', [ProfileController::class, 'dashboard']);
    Route::get('/edit-profile', [ProfileController::class, 'edit']);
    Route::post('/update-profile', [ProfileController::class, 'update']);
    Route::get('/change-password', [ProfileController::class, 'changeForm']);
    Route::post('/change-password', [ProfileController::class, 'changePassword']);
});

/* Admin */

Route::get('/admin/login', [AdminController::class, 'showLogin']);
Route::post('/admin/login', [AdminController::class, 'login']);

Route::middleware(['admin.auth'])->group(function () {

    Route::get('/admin/dashboard', [AdminController::class, 'dashboard']);

    Route::get('/admin/unverified', [AdminController::class, 'unverified']);
    Route::get('/admin/verified', [AdminController::class, 'verified']);
    Route::get('/admin/inactive', [AdminController::class, 'inactive']);

    Route::get('/admin/verify/{id}', [AdminController::class, 'verifyUser']);
    Route::get('/admin/inactive-user/{id}', [AdminController::class, 'inactiveUser']);

    Route::get('/admin/logout', [AdminController::class, 'logout']);
});
STEP 9: VIEWS STRUCTURE

Create folders:

resources/views/user/
resources/views/admin/

User pages:

register.blade.php

login.blade.php

dashboard.blade.php

edit.blade.php

change.blade.php

Admin pages:

login.blade.php

dashboard.blade.php

unverified.blade.php

verified.blade.php

inactive.blade.php

Each page should include:
Header with Logo (left)
Logout (right)

Admin sidebar:

Unverified Users

Verified Users

Inactive Users
